import{j as n}from"./jsx-runtime-DR9Q75dM.js";import{r as l}from"./index-DRjF_FHU.js";import{c as M}from"./classNames-DgDD4s-s.js";import"./ArticleDetails-DnES7t1v.js";import{b as N,c as V}from"./ArticleList-I1h8RCwI.js";import{A as R}from"./ArticleViewSelector-D1_fSM2Z.js";import{b as k,d as O,c as D,a as W,u as h}from"./scrollSave-CNeLDUKN.js";import{b as f,c as L,A as _}from"./article-CmWc1HkS.js";import{t as F,A as C}from"./userSlice-CdonUkG-.js";import{C as q}from"./Card-DL3b9dGt.js";import{I as Q}from"./Input-D55aBuL7.js";const ge=a=>{var e;return((e=a.articlesPage)==null?void 0:e.isLoading)||!1},pe=a=>{var e;return(e=a.articlesPage)==null?void 0:e.error},G=a=>{var e;return((e=a.articlesPage)==null?void 0:e.view)||f.SMALL},H=a=>{var e;return((e=a.articlesPage)==null?void 0:e.page)||1},K=a=>{var e;return((e=a.articlesPage)==null?void 0:e.limit)||9},me=a=>{var e;return(e=a.articlesPage)==null?void 0:e.hasMore},ue=a=>{var e;return(e=a.articlesPage)==null?void 0:e._inited},w=a=>{var e;return((e=a.articlesPage)==null?void 0:e.search)??""},v=a=>{var e;return((e=a.articlesPage)==null?void 0:e.sort)??L.CREATED},b=a=>{var e;return((e=a.articlesPage)==null?void 0:e.order)??"asc"},I=a=>{var e;return((e=a.articlesPage)==null?void 0:e.type)??_.ALL},U=a=>{const e=new URLSearchParams(window.location.search);return Object.entries(a).map(([t,o])=>{o!==void 0&&e.set(t,o)}),`?${e.toString()}`},Y=a=>{window.history.pushState(null,"",U(a))},P=k("articlesPage/fetchArticles",async(a,e)=>{const{extra:t,rejectWithValue:o,getState:i}=e,y=H(i()),S=K(i()),A=w(i()),s=b(i()),p=v(i()),m=I(i());try{Y({sort:p,order:s,search:A,type:m});const u=await t.api.get("/articles",{params:{_limit:S,_page:y,_sort:p,_order:s,type:m===_.ALL?void 0:m,q:A}});if(!u.data)throw new Error;return u.data}catch{return o(F("Ошибка"))}}),g=O({selectId:a=>a.id}),he=g.getSelectors(a=>a.articlesPage||g.getInitialState()),T=D({name:"articlesPage",initialState:g.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{},view:f.SMALL,_inited:!1,hasMore:!0,page:1,limit:9,order:"asc",search:"",sort:L.CREATED,type:_.ALL}),reducers:{setViewMode:(a,e)=>{a.view=e.payload,localStorage.setItem(C,e.payload)},initState:a=>{const e=localStorage.getItem(C);a.view=e,a.limit=e===f.SMALL?12:4,a._inited=!0},setPage:(a,e)=>{a.page=e.payload},setOrder:(a,e)=>{a.order=e.payload},setSearch:(a,e)=>{a.search=e.payload},setSort:(a,e)=>{a.sort=e.payload},setType:(a,e)=>{a.type=e.payload}},extraReducers(a){a.addCase(P.pending,(e,t)=>{e.error=void 0,e.isLoading=!0,t.meta.arg.replace&&g.removeAll(e)}).addCase(P.fulfilled,(e,t)=>{e.isLoading=!1,e.hasMore=t.payload.length>=e.limit,t.meta.arg.replace?g.setAll(e,t.payload):g.addMany(e,t.payload)}).addCase(P.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload})}}),{reducer:Ae}=T,{actions:c}=T,$="_search_14v9a_1",z="_sortWrapper_14v9a_5",B="_tabs_14v9a_12",J="_searchInput_14v9a_16",d={search:$,sortWrapper:z,tabs:B,searchInput:J};function X(a,e){const t=l.useRef();return l.useCallback((...o)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{a(...o)},e)},[a,e])}const Z=a=>{const{className:e}=a,t=W(),o=h(G),i=h(w),y=h(v),S=h(b),A=h(I),s=l.useCallback(()=>{t(P({replace:!0}))},[t]),p=X(s,300),m=l.useCallback(r=>{t(c.setViewMode(r))},[t]),u=l.useCallback(r=>{t(c.setSearch(r)),t(c.setPage(1)),p()},[t,p]),j=l.useCallback(r=>{t(c.setOrder(r)),t(c.setPage(1)),s()},[t,s]),x=l.useCallback(r=>{t(c.setSort(r)),t(c.setPage(1)),s()},[t,s]),E=l.useCallback(r=>{t(c.setType(r)),t(c.setPage(1)),s()},[t,s]);return n.jsxs("div",{className:M(d.ArticlesPageFilters,{},[e]),children:[n.jsxs("div",{className:d.sortWrapper,children:[n.jsx(N,{sort:y,order:S,onChangeOrder:j,onChangeSort:x}),n.jsx(R,{className:d.viewSelector,view:o,onViewClick:m})]}),n.jsx(q,{className:d.search,children:n.jsx(Q,{className:d.searchInput,placeholder:"Поиск",value:i,onChange:u})}),n.jsx(V,{className:d.tabs,onChangeType:E,value:A})]})};Z.__docgenInfo={description:"",methods:[],displayName:"ArticlesPageFilters",props:{className:{required:!1,tsType:{name:"string"},description:""}}};export{Z as A,H as a,ge as b,c,ue as d,G as e,P as f,me as g,pe as h,he as i,Ae as j};
