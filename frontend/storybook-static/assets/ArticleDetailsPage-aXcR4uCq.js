import{j as s}from"./jsx-runtime-CexXSJP5.js";import{c as n}from"./classNames-DgDD4s-s.js";import{r as C}from"./index-BP8_t0zE.js";import{b as A}from"./ArticleDetails-lUYFg-Pt.js";import{T as c}from"./Text-7oj-NtWT.js";import{A as y,a as T}from"./Avatar-DgOqVGEJ.js";import{S as d}from"./Skeleton-CD873yLi.js";import{D}from"./DynamicModuleLoader-zWzWfUIV.js";import{c as L,t as u,e as v,a as S,b as f}from"./userSlice-BUja-80x.js";import{b as k}from"./useAppDispatch-CHJEm9Vz.js";import{f as I}from"./index-BhItUGrV.js";import{u as q}from"./useTranslation-B2QVmqVC.js";import"./articleDetailsSlice-CiyBvNif.js";import"./Code-ClL86nT1.js";import"./Button-CULVALhb.js";import"./index-DJkmxc1E.js";const w="_commentTitle_12mnc_1",p={commentTitle:w},B="_comment_1ejun_1",x={comment:B},b="_CommentCard_1xfml_1",P="_authorBlock_1xfml_9",E="_commentText_1xfml_14",$="_skeletonCommentCard_1xfml_18",o={CommentCard:b,authorBlock:P,commentText:E,skeletonCommentCard:$},g=a=>{const{className:t,comment:e,isLoading:r}=a;return r?s.jsxs("div",{className:n(o.CommentCard,{},[t]),children:[s.jsxs("div",{className:o.authorBlock,children:[e.user.avatar&&s.jsx(d,{width:60,height:60,border:"50%"}),s.jsx(d,{className:o.commentUsername,width:150,height:20})]}),s.jsx(d,{className:o.commentText,width:"100%",height:50})]}):s.jsxs("div",{className:n(o.CommentCard,{},[t]),children:[s.jsxs("div",{className:o.authorBlock,children:[e.user.avatar&&s.jsx(y,{src:e.user.avatar,rounded:!0,size:T.S}),s.jsx(c,{className:o.commentUsername,text:e.user.username})]}),s.jsx(c,{className:o.commentText,text:e.text})]})};g.__docgenInfo={description:"",methods:[],displayName:"CommentCard",props:{className:{required:!1,tsType:{name:"string"},description:""},comment:{required:!0,tsType:{name:"Comment"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:""}}};const h=a=>{const{className:t,comments:e,isLoading:r}=a;return console.log(e," comments"),s.jsx("div",{className:n(x.CommentList,{},[t]),children:e!=null&&e.length?e==null?void 0:e.map(m=>s.jsx(g,{isLoading:r,className:x.comment,comment:m})):s.jsx(c,{text:"Комментарии отсутствуют"})})};h.__docgenInfo={description:"",methods:[],displayName:"CommentList",props:{className:{required:!1,tsType:{name:"string"},description:""},comments:{required:!1,tsType:{name:"Array",elements:[{name:"Comment"}],raw:"Comment[]"},description:""},isLoading:{required:!1,tsType:{name:"boolean"},description:""}}};const i=L("articleDetails/fetchCommentsByArticleId",async(a,t)=>{const{extra:e,rejectWithValue:r}=t;if(!a)return r(u("Ошибка"));try{const m=await e.api.get("/comments",{params:{articleId:a,_expand:"user"}});if(!m.data)throw new Error;return m.data}catch{return r(u("Ошибка"))}}),l=v({selectId:a=>a.id}),R=l.getSelectors(a=>a.articleDetailsComments||l.getInitialState()),U=S({name:"articleDetailsCommentsSlice",initialState:l.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:a=>a.addCase(i.pending,t=>{t.error=void 0,t.isLoading=!0}).addCase(i.fulfilled,(t,e)=>{t.isLoading=!1,l.setAll(t,e.payload)}).addCase(i.rejected,(t,e)=>{t.isLoading=!1,t.error=e.payload})}),{reducer:z}=U,M=a=>{var t;return(t=a.articleDetailsComments)==null?void 0:t.isLoading},V={articleDetailsComments:z},_=a=>{const t=k(),{className:e}=a,{id:r}=I(),{t:m}=q("article-details"),j=f(R.selectAll),N=f(M);return C.useEffect(()=>{t(i(r))},[t,r]),r?s.jsx(D,{reducers:V,removeAfterUnmount:!0,children:s.jsxs("div",{className:n(p.ArticleDetailsPage,{},[e]),children:[s.jsx(A,{id:r}),s.jsx(c,{className:p.commentTitle,title:"Комментарии"}),s.jsx(h,{isLoading:N,comments:j})]})}):s.jsx("div",{className:n(p.ArticleDetailsPage,{},[e]),children:m("Статья не найдена")})},oe=C.memo(_);_.__docgenInfo={description:"",methods:[],displayName:"ArticleDetailsPage",props:{className:{required:!1,tsType:{name:"string"},description:""}}};export{oe as default};
