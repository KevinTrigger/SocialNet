import{R as n,b as f,c as C,t as p,d as S}from"./i18next-CEY2YAwM.js";import{r as T}from"./index-BP8_t0zE.js";function c(a){a===void 0&&(a=n);var e=a===n?f:function(){return T.useContext(a)};return function(){var o=e(),t=o.store;return t}}var A=c();function N(a){a===void 0&&(a=n);var e=a===n?A:c(a);return function(){var o=e();return o.dispatch}}var l=N();const E=C("profile/fetchProfileData",async(a,e)=>{const{extra:r,rejectWithValue:o}=e;try{const t=await r.api.get("/profile");if(!t.data)throw new Error;return t.data}catch{return o(p("Ошибка"))}});var s=(a=>(a.INCORRECT_USER_FIRSTNAME="INCORRECT_USER_FIRSTNAME",a.INCORRECT_USER_LASTNAME="INCORRECT_USER_LASTNAME",a.INCORRECT_USER_USERNAME="INCORRECT_USER_USERNAME",a.INCORRECT_USER_AGE="INCORRECT_USER_AGE",a.INCORRECT_USER_COUNTRY="INCORRECT_USER_COUNTRY",a.INCORRECT_CHARACTERS="INCORRECT_CHARACTERS",a.INCORRECT_USER_AVATAR="INCORRECT_USER_AVATAR",a.NO_DATA="NO_DATA",a.SERVER_ERROR="SERVER_ERROR",a))(s||{});const O=a=>{var e;return(e=a.profile)==null?void 0:e.form},I=a=>{if(!a)return[s.NO_DATA];const{firstname:e,lastname:r,age:o,country:t,username:d}=a,R=[];return e||R.push(s.INCORRECT_USER_FIRSTNAME),r||R.push(s.INCORRECT_USER_LASTNAME),(e!=null&&e.match(/\d{1}/)||r!=null&&r.match(/\d{1}/))&&R.push(s.INCORRECT_CHARACTERS),d||R.push(s.INCORRECT_USER_USERNAME),(!o||!Number.isInteger(o))&&R.push(s.INCORRECT_USER_AGE),t||R.push(s.INCORRECT_USER_COUNTRY),R},u=C("profile/updateProfileData",async(a,e)=>{const{extra:r,rejectWithValue:o,getState:t}=e,d=O(t()),R=I(d);if(R!=null&&R.length)return o(R);try{const i=await r.api.put("/profile",d);if(!i.data)throw new Error;return i.data}catch{return o([s.SERVER_ERROR])}}),h={readonly:!0,isLoading:!1,error:void 0,data:void 0,form:void 0},_=S({name:"profile",initialState:h,reducers:{setReadonly:(a,e)=>{a.readonly=e.payload},updateProfile:(a,e)=>{a.form={...a.form,...e.payload}},cancelEdit:a=>{a.readonly=!0,a.form=a.data,a.validateError=void 0}},extraReducers:a=>{a.addCase(E.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(E.fulfilled,(e,r)=>{e.isLoading=!1,e.data=r.payload,e.form=r.payload}).addCase(E.rejected,(e,r)=>{e.isLoading=!1,e.error=r.payload}).addCase(u.pending,e=>{e.validateError=void 0,e.isLoading=!0}).addCase(u.fulfilled,(e,r)=>{e.isLoading=!1,e.data=r.payload,e.form=r.payload,e.readonly=!0,e.validateError=void 0}).addCase(u.rejected,(e,r)=>{e.isLoading=!1,e.validateError=r.payload})}}),{actions:y}=_,{reducer:g}=_,m=()=>l();export{s as V,A as a,m as b,u as c,g as d,E as f,O as g,y as p,l as u};
