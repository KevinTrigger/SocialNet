import{j as n}from"./jsx-runtime-CexXSJP5.js";import{r as l}from"./index-BP8_t0zE.js";import{c as x}from"./classNames-DgDD4s-s.js";import"./ArticleDetails-DNB7ceQ3.js";import"./ArticleList-BFAKmBrP.js";import{A as I,a as b}from"./ArticleSortSelector-Cxvm9rSO.js";import{b as M,d as V,c as N,f as R,e as h}from"./scrollSave-CvpIp14x.js";import{b as S,c as C}from"./TextBlock-4LNlnsRv.js";import{t as T,A as w}from"./localStorage-CnWtazwr.js";import{C as k}from"./Card--r5Y039_.js";import{I as O}from"./Input-SBXS8SFk.js";const re=a=>{var e;return((e=a.articlesPage)==null?void 0:e.isLoading)||!1},ce=a=>{var e;return(e=a.articlesPage)==null?void 0:e.error},D=a=>{var e;return((e=a.articlesPage)==null?void 0:e.view)||S.SMALL},W=a=>{var e;return((e=a.articlesPage)==null?void 0:e.page)||1},F=a=>{var e;return((e=a.articlesPage)==null?void 0:e.limit)||9},oe=a=>{var e;return(e=a.articlesPage)==null?void 0:e.hasMore},ie=a=>{var e;return(e=a.articlesPage)==null?void 0:e._inited},y=a=>{var e;return((e=a.articlesPage)==null?void 0:e.search)??""},_=a=>{var e;return((e=a.articlesPage)==null?void 0:e.sort)??C.CREATED},L=a=>{var e;return((e=a.articlesPage)==null?void 0:e.order)??"asc"},$=a=>{const e=new URLSearchParams(window.location.search);return Object.entries(a).map(([t,s])=>{console.log(`${t}: ${s}, name and value`),s!==void 0&&e.set(t,s)}),`?${e.toString()}`},q=a=>{window.history.pushState(null,"",$(a))},A=M("articlesPage/fetchArticles",async(a,e)=>{const{extra:t,rejectWithValue:s,getState:c}=e,P=W(c()),f=F(c()),r=y(c()),g=L(c()),m=_(c());try{q({sort:m,order:g,search:r});const p=await t.api.get("/articles",{params:{_limit:f,_page:P,_sort:m,_order:g,q:r}});if(!p.data)throw new Error;return p.data}catch{return s(T("Ошибка"))}}),d=V({selectId:a=>a.id}),le=d.getSelectors(a=>a.articlesPage||d.getInitialState()),v=N({name:"articlesPage",initialState:d.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{},view:S.SMALL,_inited:!1,hasMore:!0,page:1,limit:9,order:"asc",search:"",sort:C.CREATED}),reducers:{setViewMode:(a,e)=>{a.view=e.payload,localStorage.setItem(w,e.payload)},initState:a=>{const e=localStorage.getItem(w);a.view=e,a.limit=e===S.SMALL?9:4,a._inited=!0},setPage:(a,e)=>{a.page=e.payload},setOrder:(a,e)=>{a.order=e.payload},setSearch:(a,e)=>{a.search=e.payload},setSort:(a,e)=>{a.sort=e.payload}},extraReducers(a){a.addCase(A.pending,(e,t)=>{e.error=void 0,e.isLoading=!0,t.meta.arg.replace&&d.removeAll(e)}).addCase(A.fulfilled,(e,t)=>{e.isLoading=!1,e.hasMore=t.payload.length>=e.limit,t.meta.arg.replace?d.setAll(e,t.payload):d.addMany(e,t.payload)}).addCase(A.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload})}}),{reducer:ne}=v,{actions:i}=v,Q="_search_1edf1_1",G="_sortWrapper_1edf1_5",u={search:Q,sortWrapper:G};function H(a,e){const t=l.useRef();return l.useCallback((...s)=>{t.current&&clearTimeout(t.current),t.current=setTimeout(()=>{a(...s)},e)},[a,e])}const K=a=>{const{className:e}=a,t=R(),s=h(D),c=h(y),P=h(_),f=h(L),r=l.useCallback(()=>{t(A({replace:!0}))},[t]),g=H(r,300),m=l.useCallback(o=>{t(i.setViewMode(o))},[t]),p=l.useCallback(o=>{t(i.setSearch(o)),t(i.setPage(1)),g()},[t,g]),E=l.useCallback(o=>{t(i.setOrder(o)),t(i.setPage(1)),r()},[t,r]),j=l.useCallback(o=>{t(i.setSort(o)),t(i.setPage(1)),r()},[t,r]);return n.jsxs("div",{className:x(u.ArticlesPageFilters,{},[e]),children:[n.jsxs("div",{className:u.sortWrapper,children:[n.jsx(I,{sort:P,order:f,onChangeOrder:E,onChangeSort:j}),n.jsx(b,{className:u.viewSelector,view:s,onViewClick:m})]}),n.jsx(k,{className:u.search,children:n.jsx(O,{placeholder:"Поиск",value:c,onChange:p})})]})};K.__docgenInfo={description:"",methods:[],displayName:"ArticlesPageFilters",props:{className:{required:!1,tsType:{name:"string"},description:""}}};export{K as A,W as a,re as b,i as c,ie as d,D as e,A as f,oe as g,ce as h,le as i,ne as j};
