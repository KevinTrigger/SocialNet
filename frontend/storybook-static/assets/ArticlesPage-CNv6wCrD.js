import{j as l}from"./jsx-runtime-Cw0GR0a5.js";import{r as m}from"./index-CTjT7uj6.js";import{c as x}from"./classNames-DgDD4s-s.js";import"./ArticleDetails-BAER68Ci.js";import{A as w}from"./ArticleList-CAoFIxqW.js";import{A as E}from"./ArticleViewSelector-NafimWvV.js";import{D as M}from"./DynamicModuleLoader-BDb88CFe.js";import{a as P,t as T,b as _,c as j,A,d as g}from"./localStorage-BvkLEUEt.js";import{b as f}from"./TextBlock-rgxTaeNS.js";import{T as v,b as C}from"./Text-a7QVxXHR.js";import{b as I}from"./useAppDispatch-Bt7wXbJ2.js";import{P as N}from"./Page-DOlsuWKT.js";import"./articleDetailsSlice-CwCYt7Jc.js";import"./Skeleton-C9-T3umZ.js";import"./Avatar-BpDMNdIA.js";import"./Icon-DzJ0BDpg.js";import"./Code-De6n1HLF.js";import"./Button-FfmSwvyD.js";import"./useTranslation-DegO0IwE.js";import"./ArticleListItem-XSJToFHR.js";import"./Card-Bd8Xtrjy.js";import"./routeConfig-DLoIAoyA.js";import"./iframe-CRRPQNvt.js";import"../sb-preview/runtime.js";import"./NotFoundPage-DKH1jNB_.js";import"./index-CVbFUeQw.js";import"./index-vZN_Bsf0.js";const V="_TempStyle_39dxf_1",R={TempStyle:V},u=t=>{var e;return((e=t.articlesPage)==null?void 0:e.isLoading)||!1},b=t=>{var e;return(e=t.articlesPage)==null?void 0:e.error},k=t=>{var e;return(e=t.articlesPage)==null?void 0:e.view},D=t=>{var e;return((e=t.articlesPage)==null?void 0:e.page)||1},O=t=>{var e;return((e=t.articlesPage)==null?void 0:e.limit)||9},W=t=>{var e;return(e=t.articlesPage)==null?void 0:e.hasMore},n=P("articlesPage/fetchArticles",async(t,e)=>{const{extra:a,rejectWithValue:s,getState:i}=e,{page:r=1}=t,o=O(i());try{const c=await a.api.get("/articles",{params:{_limit:o,_page:r}});if(!c.data)throw new Error;return c.data}catch{return s(T("Ошибка"))}}),p=_({selectId:t=>t.id}),q=p.getSelectors(t=>t.articlesPage||p.getInitialState()),h=j({name:"articlesPage",initialState:p.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{},view:f.SMALL,hasMore:!0,page:1}),reducers:{setViewMode:(t,e)=>{t.view=e.payload,localStorage.setItem(A,e.payload)},initState:t=>{const e=localStorage.getItem(A);t.view=e,t.limit=e===f.SMALL?9:4},setPage:(t,e)=>{t.page=e.payload}},extraReducers(t){t.addCase(n.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(n.fulfilled,(e,a)=>{e.isLoading=!1,p.addMany(e,a.payload),e.hasMore=a.payload.length>0}).addCase(n.rejected,(e,a)=>{e.isLoading=!1,e.error=a.payload})}}),{reducer:G}=h,{actions:d}=h,H=P("articlesPage/fetchNextArticlesPage",async(t,e)=>{const{getState:a,dispatch:s}=e,i=W(a()),r=D(a()),o=u(a());i&&!o&&(s(d.setPage(r+1)),s(n({page:r+1})))}),K={articlesPage:G},S=t=>{const{className:e}=t,a=I(),s=g(k),i=g(b),r=g(u),o=g(q.selectAll);m.useEffect(()=>{a(d.initState()),a(n({page:1}))},[a]);const c=m.useCallback(()=>{a(H())},[a]),L=m.useCallback(y=>{a(d.setViewMode(y))},[a]);return i?l.jsx(v,{theme:C.ERROR,title:"Ошибка при загрузке списка статей"}):l.jsx(M,{reducers:K,removeAfterUnmount:!0,children:l.jsxs(N,{className:x(R.ArticlesPage,{},[e]),onScrollEnd:c,children:[l.jsx(E,{view:s,onViewClick:L}),l.jsx(w,{articles:o,view:s,isLoading:r})]})})},ue=m.memo(S);S.__docgenInfo={description:"",methods:[],displayName:"ArticlesPage",props:{className:{required:!1,tsType:{name:"string"},description:""}}};export{ue as default};
